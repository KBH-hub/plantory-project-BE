<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>내 프로필</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet"/>
    <link rel="stylesheet" th:href="@{/css/header.css}">
    <link rel="stylesheet" th:href="@{/css/profile.css}">
    <link rel="stylesheet" th:href="@{/css/alert.css}">
</head>

<body class="bg-light">
<th:block th:replace="~{fragments/header :: headerBar}"></th:block>
<div class="container mt-4 pb-4">

    <h4 class="fw-bold border-bottom pb-2">내 프로필</h4>
    <p class="text-muted small mt-1">나의 식물 &gt; 내 프로필 &gt; 내 정보 변경</p>

    <div class="mt-4 text-center d-flex justify-content-center">
        <div class="img-wrapper">

            <div class="text-center">
                <div id="profileImageBox" class="profile-img d-flex justify-content-center align-items-center">
                    <input type="file" id="profileImgInput" accept="image/*" style="display:none;">
                    <img id="profilePreview" class="rounded-circle" width="150" height="150">
                </div>
            </div>

            <button id="changeProfileImgBtn" class="btn btn-primary btn-sm delete-btn">프로필 사진 변경</button>
        </div>
    </div>

    <form id="profileForm" class="mt-4 px-3">

        <div class="mb-3 row">
            <label class="col-sm-2 col-form-label">닉네임</label>
            <div class="col-sm-6">
                <input id="nicknameInput" type="text" class="form-control" placeholder="닉네임 입력">
            </div>
            <div class="col-sm-3">
                <button id="checkNicknameBtn" type="button" class="btn btn-outline-dark">중복 확인</button>
            </div>
        </div>

        <div class="mb-3 row">
            <label class="col-sm-2 col-form-label">비밀번호</label>
            <div class="col-sm-6">
                <input id="passwordInput" type="password" class="form-control" placeholder="새 비밀번호" disabled>
            </div>
            <div class="col-sm-4">
                <button id="openPwChangeModalBtn" type="button" class="btn btn-outline-dark" data-bs-toggle="modal"
                        data-bs-target="#changePwModal">비밀번호 변경</button>
            </div>
        </div>

        <div class="mb-3 row">
            <label class="col-sm-2 col-form-label">휴대전화</label>
            <div class="col-sm-6">
                <input id="phoneInput" type="text" class="form-control" placeholder="010-1234-5678">
            </div>
        </div>

        <div class="mb-3 row">
            <label class="col-sm-2 col-form-label">주소</label>
            <div class="col-sm-3">
                <select id="sido" class="form-select">
                    <option>전체 시/도</option>
                </select>
            </div>
            <div class="col-sm-3">
                <select id="sigungu" class="form-select">
                    <option>시/군/구</option>
                </select>
            </div>
        </div>

        <div class="mb-4 row">
            <label class="col-sm-2 col-form-label">알림 설정</label>
            <div class="col-sm-6">
                <div class="form-check form-switch mt-2">
                    <input id="noticeToggle" class="form-check-input" type="checkbox" checked>
                </div>
            </div>
        </div>

        <div class="d-flex justify-content-between align-items-center mt-4">
            <button id="openWithdrawModalBtn" type="button" class="btn btn-outline-danger btn-sm"
                    data-bs-toggle="modal" data-bs-target="#withdrawModal">회원탈퇴</button>

            <div>
                <button id="cancelBtn" type="button" class="btn btn-danger">취소</button>
                <button id="submitProfileBtn" type="submit" class="btn btn-success">확인</button>
            </div>
        </div>

    </form>
</div>


<div class="modal fade" id="changePwModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">

            <div class="modal-header border-0">
                <h5 class="modal-title fw-bold">비밀번호 변경</h5>
                <button id="pwModalCloseBtn" type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body pt-0">

                <label class="fw-bold">기존 비밀번호
                    <span id="oldPwMsg" class="text-danger d-none">*일치하지 않습니다.</span>
                </label>
                <input id="oldPwInput" type="password" class="form-control mb-4">

                <label class="fw-bold">새 비밀번호
                    <span id="newPwMsg" class="text-danger d-none">*기존과 같습니다.</span>
                </label>
                <input id="newPwInput" type="password" class="form-control mb-4">

                <label class="fw-bold">새 비밀번호 확인
                    <span id="newPwCheckMsg" class="text-danger d-none">*비밀번호가 일치하지 않습니다.</span>
                </label>
                <input id="newPwCheckInput" type="password" class="form-control mb-4">
            </div>

            <div class="modal-footer border-0 d-flex justify-content-center gap-5">
                <button id="pwCancelBtn" type="button" class="btn btn-secondary btn-lg px-5" data-bs-dismiss="modal">취소</button>
                <button id="pwConfirmBtn" type="button" class="btn btn-success btn-lg px-5">변경</button>
            </div>


        </div>
    </div>
</div>


<div class="modal fade" id="withdrawModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">

            <div class="modal-header border-0">
                <h5 class="modal-title fw-bold">회원탈퇴</h5>
                <button id="withdrawModalCloseBtn" type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <div class="modal-body text-center">

                <p class="text-danger fw-bold fs-5">정말로 탈퇴하시겠습니까?</p>

                <p class="text-muted small">
                    탈퇴 시 모든 개인 정보와 데이터가 삭제되며, 복구가 불가능합니다.<br>
                    단, 관련 법령에 따라 일부 정보는 일정 기간 보관될 수 있습니다.<br>
                    탈퇴 후 5일 이내에는 동일한 아이디로 재가입이 제한됩니다.
                </p>

                <div class="form-check d-flex justify-content-center align-items-center mt-4">
                    <input id="agreeWithdrawCheck" class="form-check-input me-1" type="checkbox">
                    <label class="form-check-label fw-bold" for="agreeWithdrawCheck">위의 사항에 동의합니다.</label>
                </div>

                <span id="withdrawMsg" class="text-danger small d-none">*동의해야 회원탈퇴가 가능합니다.</span>

            </div>

            <div class="modal-footer border-0 d-flex justify-content-center gap-5">
                <button id="withdrawCancelBtn" type="button" class="btn btn-secondary btn-lg px-5" data-bs-dismiss="modal">취소</button>
                <button id="withdrawBtn" type="button" class="btn btn-danger btn-lg px-5" disabled>회원 탈퇴</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script th:src="@{/js/common/apiCode.js}"></script>
<script th:src="@{/js/common/header.js}"></script>
<script th:src="@{/js/common/korean.js}"></script>

<script th:src="@{/js/profile/updateProfileInfo.js}"></script>
<script th:src="@{/js/common/alert.js}"></script>
<script th:inline="javascript">
    const ProfileData = /*[[${profileInfo}]]*/ {};
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>